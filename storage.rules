rules_version = '2';

// Storage rules for Guest Menu app
service firebase.storage {
  match /b/{bucket}/o {
    
    // Super admin check
    function isSuperAdmin() {
      return request.auth.token.email == 'guestmenu0@gmail.com';
    }
    
    // Logos - can be uploaded by super admin or business owner
    match /logos/{subdomain}/{fileName} {
      allow read: if true; // Public read
      allow write: if isSuperAdmin() || request.auth != null;
      allow create: if isSuperAdmin() || request.auth != null;
      allow delete: if isSuperAdmin();
    }
    
    // User avatars - can be uploaded by user or super admin
    match /avatars/{userId}/{fileName} {
      allow read: if true; // Public read
      allow write: if request.auth.uid == userId || isSuperAdmin();
      allow create: if request.auth.uid == userId || isSuperAdmin();
      allow delete: if request.auth.uid == userId || isSuperAdmin();
    }
    
    // Menu images - can be uploaded by owner or super admin
    match /menu-images/{userId}/{fileName} {
      allow read: if true; // Public read
      allow write: if request.auth.uid == userId || isSuperAdmin();
      allow create: if request.auth.uid == userId || isSuperAdmin();
      allow delete: if request.auth.uid == userId || isSuperAdmin();
    }
    
    // Menu item images - can be uploaded by owner or super admin
    match /menu-items/{userId}/{itemId}/{fileName} {
      allow read: if true; // Public read for guest menu display
      allow write: if request.auth.uid == userId || isSuperAdmin();
      allow create: if request.auth.uid == userId || isSuperAdmin();
      allow delete: if request.auth.uid == userId || isSuperAdmin();
    }
  }
}

